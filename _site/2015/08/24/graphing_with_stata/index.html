<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Graphing with Stata Part I &middot; TmmGeek
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="/public/css/custom.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">


  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>



  <body>
    

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  

  <div class="sidebar-item">
    <p>This blog is my journey and passion in Computer Science, Math and programming!</p>
  </div>
   <div class="sidebar-logo" align="center" >
      <img src="http://www.gravatar.com/avatar/0f8154e563aa3319f1ebc77be5fca304?s=140" />
  </div>
  <div id="contact-list" style="text-align:center">
      
        <a href="https://github.com/JizongL">
          <span class="fa-stack fa-lg">
            <i class="fa fa-square-o fa-stack-2x"></i>
            <i class="fa fa-github-alt fa-stack-1x"></i>
          </span>
        </a>
      

      
        <a href="https://www.linkedin.com/in/jizongliang">
          <span class="fa-stack fa-lg">
            <i class="fa fa-square-o fa-stack-2x"></i>
            <i class="fa fa-linkedin fa-stack-1x"></i>
          </span>
        </a>
      

      
        <a href="mailto: 2015rpro@gmail.com">
          <span class="fa-stack fa-lg">
            <i class="fa fa-square-o fa-stack-2x"></i>
            <i class="fa fa-envelope fa-stack-1x"></i>
          </span>
        </a>
      

      
        <a href="https://twitter.com/TmmGeek">
          <span class="fa-stack fa-lg">
            <i class="fa fa-square-o fa-stack-2x"></i>
            <i class="fa fa-twitter-square fa-stack-1x"></i>
          </span>
        </a>
      

  </div>

   
  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>
  
    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/ProbabilityAndStastics/">My Chinese Site</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About Me</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
    
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/mycredential/">Certificates</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/onlineTools/">Collection</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/tags/">Tags</a>
        
      
    

    
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2016. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">TmmGeek</a>
            <small>A blog for bioinformatics programming and statistics</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Graphing with Stata Part I</h1>
  <span class="post-date">24 Aug 2015</span>
  <p>Analytical graphics have always been one of Stata’s strengths, and reason enough for many users to choose Stata over other packages.
<!--break--></p>

<p>Attractive and publishable basic graphs are easy to draw, using commands or choices from the menus under Graphics. Users who imagine more elaborate or creative graphs will find their efforts supported by an impressive array of tools and options, described in the Graphics Reference Manual, and illustrated by many examples in A Visual Guide to Stata Graphics (Mitchell 2012).</p>

<p>The above statement was taken from<a href="http://www.stata.com/bookstore/statistics-with-stata/">2012 Statistics with Stata 12-8</a>
 by Lawrence C. Hamilton and it shows how important it is to develop good statistical graphing skills as a statistican. In this tutorial series, I will share how to use some of the most useful graphing techinques with Stata and I hope it is helpful to you. Let’s get started and go through some examples one by one and you can also download the <a href="https://dl.dropboxusercontent.com/u/49272502/stata%20blog/log/graphing.do">do file</a></p>

<h2 id="import-and-explore-the-data-set">Import and explore the data set</h2>
<p>We use the data set <a href="https://dl.dropboxusercontent.com/u/49272502/stata%20blog/Nations2.dta">Nations2.dta</a> in this tutorial, you could either download it and manually import it to Stata or you can simply use the following code to import the data set.</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">use https://dl.dropboxusercontent.com/u/49272502/stata%20blog/Nations2.dta, clear</code></pre></figure>

<p>Next, use describe have an idea how the data looks like.</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">describe </code></pre></figure>

<h3 id="histogram">Histogram</h3>

<p>First, let’s plot a basic histogram for the variable adfert, which stands for adolescent fertility rate.</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">histogram adfert, percent</code></pre></figure>

<p><img src="/assets/stata/graphing/hist1.png" alt="My helpful screenshot" /></p>

<p>Looking at the result, we can tell that the distribution is positively skew, with a mode not far above 0 and upper limit around 200. However, it is hard to describe the graph more specifically because the bars do not line up with the x axis tick marks. We can do a little improvement with the <em>options</em> , for example</p>

<ul>
  <li><strong>frequency</strong> 	Frequencies are shown on the vertical (y) axis.</li>
  <li><strong>start(0)</strong>	The histogram’s first bar (bin) starts at 0.</li>
  <li><strong>width(10)</strong>	The width of each bar (bin) is 10.</li>
  <li><strong>xlabel(0(20)200)</strong>	The x axis is labeled from 0 to 200, in increments of 20.</li>
  <li><strong>xtick(10(20)210)</strong>	The x axis has tick marks from 10 to 210, in increments of 20.</li>
  <li><strong>ylabel(0(5)35, grid gmax)</strong> The y axis is labeled from 0 to 35, in increments of 5. A grid of horizontal lines is drawn, including a * line at the maximum value.</li>
  <li><strong>title(“Adolescent fertility rate in 194 nations”)</strong> 	The graph has a title at top.</li>
</ul>

<p>You can put all of the above items together in the following fashion</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">histogram adfert, frequency start(0) width(10) xlabel(0(20)200) xtick(10(20)210)
ylabel(0(5)35, grid gmax)
title("Adolescent fertility rate in 194 nations")</code></pre></figure>

<p><img src="/assets/stata/graphing/hist2.png" alt="My helpful screenshot" /></p>

<p>How, we can see the improved result describes the distribution more specifically. For example, we now see that in 34 nations, the adolescent fertility rates are between 10 and 20. You can type <strong>help histogram</strong> in stata console to learn more about histogram plotting.</p>

<p>To explore the variable <em>adfert</em> further, we can use a <strong>by</strong>(varname) option. For example, if we want to illustrate with histograms of <em>adfert</em> for each of the five regions, along with a sixth <strong>(total)</strong> histogram showing the distribution for all nations. We can use the following code</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">histogram adfert, percent start(0) width(10) by(region, total)</code></pre></figure>

<p><img src="/assets/stata/graphing/hist3.png" alt="My helpful screenshot" /></p>

<p>Next, we explore the Box Plots</p>

<h3 id="box-plots">Box Plots</h3>

<p>Box plots convey information about center, spread, symmetry and outliers at a glance. For example</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">graph box adfert</code></pre></figure>

<p><img src="/assets/stata/graphing/box1.png" alt="My helpful screenshot" /></p>

<p>The result confirms the positive skew of this distribution, and shows five high outliers. The box plot extends from approximately 1st to third quartiles, a distance called the interquartile range (IQR).</p>

<p>If we want to identify the adfert outliers by with labels, we can add a <strong>marker</strong> option as follow.</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">graph box adfert, marker(1, mlabel(country)) ytitle("Births per 1,000 females 15-19")</code></pre></figure>

<p><img src="/assets/stata/graphing/box2.png" alt="My helpful screenshot" /></p>

<p>Now, if we want to compare the distributions of <em>adfert</em> from all 5 regions with a baseline, for instance 40, as well as labelling the outliers with their country names. We can use the option <strong>over</strong> and the <strong>yline()</strong> as following.</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">graph box adfert, marker(1, mlabel(country)) yline(39.3) over(region)</code></pre></figure>

<p><img src="/assets/stata/graphing/box3.png" alt="My helpful screenshot" /></p>

<p>We can also plot the boxplots horizontally by using the command <strong>hbox</strong></p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">graph hbox co2, over(region)
note("note: {bf:Statistics with Stata}, version 12") caption("caption: United Nations Human Development Report 2011") title("title: {it:Example of horizontal box plots}") ytitle("ytitle: Tons of CO{subscript:2} emitted per capita")</code></pre></figure>

<p><img src="/assets/stata/graphing/box4.png" alt="My helpful screenshot" /></p>

<p>Note that individual outliers are not labeled in the figure because they would be hard to read in the horizontal format. To explore more about boxplot you can type <strong>help graph box</strong> in the console. Now, we are going to explore Scatterplots and Overlays</p>

<h3 id="scatterplots-and-overlays">Scatterplots and Overlays</h3>

<p>Stata’s basic scatterplot command has the form</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">graph twoway scatter y x</code></pre></figure>

<p>Now, let’s make a twoway scatterplot with the variable <strong>life</strong> and <strong>school</strong></p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">graph twoway scatter life school</code></pre></figure>

<p><img src="/assets/stata/graphing/scatter1.png" alt="My helpful screenshot" /></p>

<p>To make thing more interesting, we can manipulate the <strong>frequency weight feature</strong> with <strong>[fweight = varname]</strong> as follow</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">graph twoway scatter life school [fweight=pop], msymbol(Oh)</code></pre></figure>

<p><img src="/assets/stata/graphing/scatter2.png" alt="My helpful screenshot" /></p>

<p>The result is simply a redrawn scatterplot of <em>life</em> againist <em>school</em>, but make the symbol size reflect each country’s population <em>pop</em>. Note that it also include <strong>msymbol(Oh)</strong> to change the default dot from the previous scatterplot into <em>hollow circle</em>.</p>

<p>Now, let’s explore a key feature of Stata’s graph twoway family, that is we can overlay two or more graphs to build a more complex images. For example, we can plot a regression lines **lfit) on top of the scatter plot.</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">twoway (scatter life school, msymbol(Oh))(lfit life school, lwidth(medthick))</code></pre></figure>

<p><img src="/assets/stata/graphing/scatter3.png" alt="My helpful screenshot" /></p>

<p>We can also add x and y labels and tick mark as well as legend, for example</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">twoway (scatter life school, msymbol(Oh))(lfit life school, lwidth(medthick)ylabel(45(5)85) xlabel(2(2)12) xtick(1(2)13) legend(col(1) ring(0) position(11)))</code></pre></figure>

<p><img src="/assets/stata/graphing/scatter4.png" alt="My helpful screenshot" /></p>

<p>note
The <em>legend option</em> in the figure specifies three things:</p>

<ul>
  <li><strong>col(1)</strong> The legend should have just one column, and hence two rows.</li>
  <li><strong>ring(0)</strong> The legend is placed within the plot region, instead of outside it.</li>
  <li><strong>position(11)</strong> The legend goes at the <em>11 o’clock position</em>, which in this graph happens to
be empty of data.</li>
</ul>

<p>Finally, let’s try to graph a more advanced regression scatterplot shows also the confident bands for the <em>conditonal mean of y</em>.  We can do so with the command <strong>lfitci</strong> and <strong>stdp</strong>. note that the <em>ci</em> in <strong>lfitci</strong> refers to <em>confident interval</em> and <strong>stdp</strong> refers to standard erors for the conditional mean as “standard deviation of prediction”</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">twoway (lfitci life school, stdp)(scatter life school, msymbol(Th))(scatter life school if school &gt; 8 &amp; life &lt; 55, msymbol(S) mlabel(country)legend(col(1) ring(0) position(11) label(3 "Life expectancy")order(3 2 1)))</code></pre></figure>

<p><img src="/assets/stata/graphing/scatter5.png" alt="My helpful screenshot" /></p>

<p>From the result, we see that normal data points are plotted as hollow triangles and the two outliers are solid squares. This can be accomplished by the option <strong>msymbol(Th)</strong> and <strong>msymbol(S)</strong> and you can type <strong>help scatter</strong> to learn more about the other options.</p>

<p>Lastly, we wrap up this tutorial with introducing the <strong>scatterplot matrices</strong>. Scatterplot matrices are different from other twoway plots types that it can not be overlaid. Nevertheless, it is possible to include multiple plots in a single plot and it follows the same marker symbol conventions. Let’s create an example.</p>

<figure class="highlight"><pre><code class="language-liquid" data-lang="liquid">graph matrix gdp school adfert chldmort life, half msymbol(oh)</code></pre></figure>

<p><img src="/assets/stata/graphing/scatter6.png" alt="My helpful screenshot" /></p>

<p>From the result, we see that scatterplot mattrix is the visual counterpart to a correlation mattrix, which is very helpful tool for multivariate analysis. It shows the relationships between variables pairs and thus helpful for the detection of <strong>nonlinear relationships</strong>. For instance, the scatterplot matrix above shows that <em>gdp</em> (per capita Gross Domestic Product) seems to be nonlinearly distributed and we could not have detected this pattern through correlation matrix alone. You can type <strong>help graph matrix</strong> to learn more about scatterplot mattrix.</p>

<p>Congradulation, now you have completed part I of this tutorial and in part II we will explore <strong>Line Plots and Connected-Line Plots</strong>. Thank you for sticking around and please leave your comment and advise so that I can imporve it.</p>

</div>
<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/math/2016/09/04/Homogenous-systems/">
            Homogeneous System
            <small>04 Sep 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/text%20editing/2016/01/28/Extract-PPT-slide-title/">
            Extract PPT slide number and title
            <small>28 Jan 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/twine/2016/01/18/twine-makes-study-easy/">
            How to Twine Your Note Into a Webpage
            <small>18 Jan 2016</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
        
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'geektmm';
    var disqus_identifier = "/2015/08/24/graphing_with_stata/";
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66527403-1', 'auto');
  ga('send', 'pageview');

</script>
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
