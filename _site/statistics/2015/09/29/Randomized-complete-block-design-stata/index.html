<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Randomized complete blocked design &middot; TmmGeek
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="/public/css/custom.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">


  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  

  <div class="sidebar-item">
    <p>This blog is created for sharing my love and 
      experiences with Bioinformatics, programming and
      statistics, thank you for visiting!</p>
  </div>
   <div class="sidebar-logo" align="center" >
      <img src="http://www.gravatar.com/avatar/0f8154e563aa3319f1ebc77be5fca304?s=140" />
  </div>
  <div id="contact-list" style="text-align:center">
      
        <a href="https://github.com/JizongL">
          <span class="fa-stack fa-lg">
            <i class="fa fa-square-o fa-stack-2x"></i>
            <i class="fa fa-github-alt fa-stack-1x"></i>
          </span>
        </a>
      

      
        <a href="https://www.linkedin.com/in/jizongliang">
          <span class="fa-stack fa-lg">
            <i class="fa fa-square-o fa-stack-2x"></i>
            <i class="fa fa-linkedin fa-stack-1x"></i>
          </span>
        </a>
      

      
        <a href="mailto: davidliangtmm@gmail.com">
          <span class="fa-stack fa-lg">
            <i class="fa fa-square-o fa-stack-2x"></i>
            <i class="fa fa-envelope fa-stack-1x"></i>
          </span>
        </a>
      

      
        <a href="https://twitter.com/JizongLiang">
          <span class="fa-stack fa-lg">
            <i class="fa fa-square-o fa-stack-2x"></i>
            <i class="fa fa-twitter-square fa-stack-1x"></i>
          </span>
        </a>
      

  </div>

   
  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>
  
    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/DataManagement/">Data Management and Visualization</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/ProbabilityAndStastics/">Probability and Statistics</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/TextMining/">Texting Mining Resource</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/mycredential/">CV</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/onlineTools/">online tools and resources</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/resource/">Pathology subsection</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/tags/">Tags</a>
        
      
    
      
        
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2015. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">TmmGeek</a>
            <small>A blog for bioinformatics programming and statistics</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Randomized complete blocked design</h1>
  <span class="post-date">29 Sep 2015</span>
  <!--->
## Randomized complete blocked design

### Question 2 

The nursing supervisor in a local health department is studying the influence of time of day on length of home visits (mins.) by the nursing staff. Individual differences among nurses might be large, so the nurse was used as a blocking factor. Does the time of day of the home visit influence the length of home visits?

<!--break-->

<p>&lt;!–&gt;
You can download the <em>do</em> file <a href="https://dl.dropboxusercontent.com/u/49272502/stata%20blog/ID740%20course%20material%20blog/module%203/doFiles/Daniel%20Ch_8_Ex_24_rcbd-2.do">here</a></p>

<p>You can download the <a href="https://dl.dropboxusercontent.com/u/49272502/stata%20blog/ID740%20course%20material%20blog/module%203/TwoWay%20Anova/Daniel%20Ch_8_Ex_24_rcbd-2.dta">Daniel EX 8_3_4.dta here</a></p>

<p>(Page 379 from Daniel 9th ed.) The aggression scores of 30 Lab animals reared under three different conditions. One animal from each of 10 litters were randomly assigned to each of the three rearing conditions (dataset Daniel Ch_8_Ex_24.dta).
Question: Do these data provide sufficient evidence to indicate that the level of crowding has an effect on aggression? Let alpha=0.05.
Solution: Step 1) Explore Data</p>

<h4 id="step-1">Step 1</h4>

<p>Exploratory data analysis</p>

<div style="width:700px;height:500px;line-height:3em;overflow:auto;padding:5px;">
<pre>
<code>
. codebook

--------------------------------------------------------------------------------------------------------------------
litter                                                                                                        LITTER
--------------------------------------------------------------------------------------------------------------------

                  type:  numeric (byte)

                 range:  [1,10]                       units:  1
         unique values:  10                       missing .:  0/30

                  mean:       5.5
              std. dev:   2.92138

           percentiles:        10%       25%       50%       75%       90%
                               1.5         3       5.5         8       9.5

--------------------------------------------------------------------------------------------------------------------
scores                                                                                                        SCORES
--------------------------------------------------------------------------------------------------------------------

                  type:  numeric (byte)

                 range:  [10,35]                      units:  1
         unique values:  6                        missing .:  0/30

            tabulation:  Freq.  Value
                             8  10
                             1  15
                             9  20
                             4  25
                             7  30
                             1  35

--------------------------------------------------------------------------------------------------------------------
cond                                                                                                            COND
--------------------------------------------------------------------------------------------------------------------

                  type:  string (str3)

         unique values:  3                        missing "":  0/30

            tabulation:  Freq.  Value
                            10  "EXT"
                            10  "MOD"
                            10  "NOT"

. 
end of do-file

. 
</code>
</pre>
</div>
<p>Check dataset structure</p>

<div style="width:700px;height:500px;line-height:3em;overflow:auto;padding:5px;">
<pre>
 <code>
. describe

Contains data from https://dl.dropboxusercontent.com/u/49272502/stata%20blog/ID740%20course%20material%20blog/module
&gt; %203/TwoWay%20Anova/Daniel%20Ch_8_Ex_24_rcbd-2.dta
  obs:            30                          
 vars:             3                          23 May 2012 16:46
 size:           150                          
--------------------------------------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
--------------------------------------------------------------------------------------------------------------------
litter          byte    %8.0g                 LITTER
scores          byte    %8.0g                 SCORES
cond            str3    %9s                   COND
--------------------------------------------------------------------------------------------------------------------
Sorted by: 

. 
end of do-file

. 
 </code>
</pre>
</div>
<p>Data is sorted by “cond” so each litter are clumped by type of condition, it doesn’t matter the in which way its sorted, sometimes it good to sort in different ways to understand data structure.</p>

<div style="width:700px;height:500px;line-height:3em;overflow:auto;padding:5px;">
<pre>
	<code>
. by cond, sort : summarize scores, format

--------------------------------------------------------------------------------------------------------------------
-&gt; cond = EXT

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      scores |         10        28.5    4.116363         20         35

--------------------------------------------------------------------------------------------------------------------
-&gt; cond = MOD

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      scores |         10        20.5    5.502525         10         30

--------------------------------------------------------------------------------------------------------------------
-&gt; cond = NOT

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      scores |         10          13    4.830459         10         20


. 

. tabstat scores, stat( mean sd) by(cond)

Summary for variables: scores
     by categories of: cond (COND)

  cond |      mean        sd
-------+--------------------
   EXT |      28.5  4.116363
   MOD |      20.5  5.502525
   NOT |        13  4.830459
-------+--------------------
 Total |  20.66667  7.958224
----------------------------

. 

	</code>
</pre>
</div>
<p>####Step 2</p>

<p>Since “cond” is a string variable, there is a need to convert it to numeric</p>
<div style="width:700px;height:500px;line-height:3em;overflow:auto;padding:5px;">
<pre>
	<code>
. gen _cond=.
(30 missing values generated)

. replace _cond=2 if cond=="EXT" &amp; !missing(cond)
(10 real changes made)

. replace _cond=1 if cond=="MOD" &amp; !missing(cond)
(10 real changes made)

. replace _cond=0 if cond=="NOT" &amp; !missing(cond)
(10 real changes made)

. 
end of do-file

. do "/var/folders/nc/tpl2k1rx68d_xgzmz310w_fc0000gn/T//SD02136.000000"

. label define cond 2 "EXT" 1 "MOD" 0 "NOT"

. label value  _cond cond

. 
end of do-file

	</code>
</pre>
</div>
<p>Double check the newly generated _cond variable aligns with the original cond</p>
<div style="width:700px;height:500px;line-height:3em;overflow:auto;padding:5px;">
<pre>
	<code>

 tab2 _cond cond //check your code

-&gt; tabulation of _cond by cond  

           |               COND
     _cond |       EXT        MOD        NOT |     Total
-----------+---------------------------------+----------
       NOT |         0          0         10 |        10 
       MOD |         0         10          0 |        10 
       EXT |        10          0          0 |        10 
-----------+---------------------------------+----------
     Total |        10         10         10 |        30 


. 
end of do-file

. 
	</code>
</pre>
</div>
<p>drop the original cond variable and rename the _cond variable to cond</p>
<div style="width:700px;height:500px;line-height:3em;overflow:auto;padding:5px;">
<pre>
	<code>

. drop cond 

. 
. rename _cond cond 

. 
end of do-file

	</code>
</pre>
</div>
<p>Summary</p>
<div style="width:700px;height:500px;line-height:3em;overflow:auto;padding:5px;">
<pre>
	<code>
. by cond, sort : summarize scores, format //summary

--------------------------------------------------------------------------------------------------------------------
-&gt; cond = NOT

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      scores |         10          13    4.830459         10         20

--------------------------------------------------------------------------------------------------------------------
-&gt; cond = MOD

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      scores |         10        20.5    5.502525         10         30

--------------------------------------------------------------------------------------------------------------------
-&gt; cond = EXT

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      scores |         10        28.5    4.116363         20         35


. 
end of do-file

	</code>
</pre>
</div>
<p>estimate means by condition and by litter</p>
<div style="width:700px;height:500px;line-height:3em;overflow:auto;padding:5px;">
<pre>
	<code>
. tabstat scores, stat( mean sd semean) by(cond) //means by condition

Summary for variables: scores
     by categories of: cond 

  cond |      mean        sd  se(mean)
-------+------------------------------
   NOT |        13  4.830459  1.527525
   MOD |      20.5  5.502525  1.740051
   EXT |      28.5  4.116363  1.301708
-------+------------------------------
 Total |  20.66667  7.958224  1.452966
--------------------------------------

. 
end of do-file

. do "/var/folders/nc/tpl2k1rx68d_xgzmz310w_fc0000gn/T//SD02136.000000"

. mean scores,over(cond) // Mean Estimation by condition

Mean estimation                   Number of obs   =         30

          NOT: cond = NOT
          MOD: cond = MOD
          EXT: cond = EXT

--------------------------------------------------------------
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
scores       |
         NOT |         13   1.527525       9.87586    16.12414
         MOD |       20.5   1.740051       16.9412     24.0588
         EXT |       28.5   1.301708      25.83771    31.16229
--------------------------------------------------------------

. 
end of do-file

. do "/var/folders/nc/tpl2k1rx68d_xgzmz310w_fc0000gn/T//SD02136.000000"

. tabstat scores, stat( mean sd) by(litter) //means by litter

Summary for variables: scores
     by categories of: litter (LITTER)

  litter |      mean        sd
---------+--------------------
       1 |        20        10
       2 |        20        10
       3 |        20        10
       4 |  16.66667  7.637626
       5 |  26.66667  7.637626
       6 |        20        10
       7 |  16.66667  5.773503
       8 |  23.33333  11.54701
       9 |        20  8.660254
      10 |  23.33333  5.773503
---------+--------------------
   Total |  20.66667  7.958224
------------------------------

. mean scores,over(litter) //mean estimation by litter

Mean estimation                   Number of obs   =         30

            1: litter = 1
            2: litter = 2
            3: litter = 3
            4: litter = 4
            5: litter = 5
            6: litter = 6
            7: litter = 7
            8: litter = 8
            9: litter = 9
           10: litter = 10

--------------------------------------------------------------
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
scores       |
           1 |         20   5.773503      8.191861    31.80814
           2 |         20   5.773503      8.191861    31.80814
           3 |         20   5.773503      8.191861    31.80814
           4 |   16.66667   4.409586      7.648052    25.68528
           5 |   26.66667   4.409586      17.64805    35.68528
           6 |         20   5.773503      8.191861    31.80814
           7 |   16.66667   3.333333      9.849235     23.4841
           8 |   23.33333   6.666667      9.698469     36.9682
           9 |         20          5      9.773852    30.22615
          10 |   23.33333   3.333333       16.5159    30.15077
--------------------------------------------------------------

. 
end of do-file

	
</code>
</pre>
</div>
<p>####Step 3</p>

<p>Plot a box Plot</p>
<div style="width:700px;height:500px;line-height:3em;overflow:auto;padding:5px;">
<pre>
	<code>
/*Box Plot */
graph box scores ///
    , over(cond) ///
	ytitle(Aggression Scores) ytitle(, size(large)) ///
	title(Distrubution of Aggression Scores by Living Condition Type, size(medlarge))
	</code>
</pre>
</div>
<p><img src="https://dl.dropboxusercontent.com/u/49272502/stata%20blog/ID740%20course%20material%20blog/module%203/graph/danielCh8Ex24Boxplot.png" alt="ddd" /></p>

<h4 id="step-4">Step 4</h4>

<p>Before moving on to ANOVA: Check the assumption of model additivity</p>
<div style="width:700px;height:500px;line-height:3em;overflow:auto;padding:5px;">
<pre>
	<code>
findit nonadd // install this package

nonadd scores cond litter // code for checking the assumption

Tukey's test of nonadditivity (Ho: model is additive)
SS nonadd =   df = 1
F (1,17) = .04801813   Pr &gt; F: .82915782

. 
end of do-file
	</code>
</pre>
</div>
<p>####Step 5</p>

<p>Perform One Way ANOVA</p>
<div style="width:700px;height:500px;line-height:3em;overflow:auto;padding:5px;">
<pre>
	<code>
/* ANOVA model */
anova scores cond litter


                         Number of obs =         30    R-squared     =  0.7922
                         Root MSE      =    4.60475    Adj R-squared =  0.6652

                  Source | Partial SS         df         MS        F    Prob&gt;F
              -----------+----------------------------------------------------
                   Model |       1455         11   132.27273      6.24  0.0003
                         |
                    cond |  1201.6667          2   600.83333     28.34  0.0000
                  litter |  253.33333          9   28.148148      1.33  0.2901
                         |
                Residual |  381.66667         18   21.203704  
              -----------+----------------------------------------------------
                   Total |  1836.6667         29   63.333333  

. 
end of do-file


	</code>
</pre>
</div>
<p>####Step 6</p>

<p>Perform PostHoc test</p>
<div style="width:700px;height:500px;line-height:3em;overflow:auto;padding:5px;">
<pre>
	<code>
pwcompare cond, mcompare(tukey) effects

Pairwise comparisons of marginal linear predictions

Margins      : asbalanced

---------------------------
             |    Number of
             |  Comparisons
-------------+-------------
        cond |            3
---------------------------

------------------------------------------------------------------------------
             |                              Tukey                Tukey
             |   Contrast   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        cond |
 MOD vs NOT  |        7.5   2.059306     3.64   0.005     2.244315    12.75568
 EXT vs NOT  |       15.5   2.059306     7.53   0.000     10.24432    20.75568
 EXT vs MOD  |          8   2.059306     3.88   0.003     2.744315    13.25568
------------------------------------------------------------------------------

. 
end of do-file

. 
	</code>
</pre>
</div>

</div>
<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/pathology/2015/10/30/laboratory-medicine-text-chapter11/">
            Bleeding and Thrombotic Disorders
            <small>30 Oct 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/statistics/2015/10/30/correlation-study/">
            correlation study
            <small>30 Oct 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/python/2015/10/30/Ipython-Jupyter-study/">
            Ipython and Jupyter study
            <small>30 Oct 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
        
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'geektmm';
    var disqus_identifier = "/statistics/2015/09/29/Randomized-complete-block-design-stata/";
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66527403-1', 'auto');
  ga('send', 'pageview');

</script>
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
